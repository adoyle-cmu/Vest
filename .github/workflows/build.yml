name: Create Production Release
on:
  push:
    tags:
      - 'v*' # This triggers only when you push a tag starting with 'v'
    branches-ignore:
      - '**' # This explicitly ignores standard branch pushes

jobs:
  build-and-release:
    runs-on: windows-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Install Briefcase
        run: pip install briefcase

      - name: Build MSI
        # 'package' runs 'create' and 'build' automatically
        run: briefcase package windows --no-input

      - name: Sign MSI (Optional but Recommended)
        # This step assumes you've added your cert to GitHub Secrets
        # If you don't have a cert yet, skip this step for now.
        shell: pwsh
        run: |
          Write-Host "Signing the MSI..."
          # signtool sign /f cert.pfx /p ${{ secrets.CERT_PASS }} windows/*.msi

      - name: Generate GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          files: dist\n*.msi
          body: "Official Windows installer for Chain of Title."
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}